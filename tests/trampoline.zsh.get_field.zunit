#!/usr/bin/env zunit

@setup {
  export ZT_DIRECTORY_DECORATOR='*'
  load '../trampoline.zsh'
}

@test 'zt_get_field_from_raw gets path' {
  # setup
  local raw_line='/tmp/dir, Test directory., true'
  local path_expected='/tmp/dir'
  # exercise
  run zt_get_field_from_raw 'path' <<< "$raw_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$path_expected"
}

@test 'zt_get_field_from_raw gets description' {
  # setup
  local raw_line='/tmp/dir, Test directory., true'
  local description_expected='Test directory.'
  # exercise
  run zt_get_field_from_raw 'description' <<< "$raw_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$description_expected"
}

@test 'zt_get_field_from_raw gets expand' {
  # setup
  local raw_line='/tmp/dir, Test directory., true'
  local expand_expected='true'
  # exercise
  run zt_get_field_from_raw 'expand' <<< "$raw_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$expand_expected"
}

@test 'zt_get_field_from_raw gets empty description' {
  # setup
  local raw_line='/tmp/dir'
  local description_expected=''
  # exercise
  run zt_get_field_from_raw 'description' <<< "$raw_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$description_expected"
}

@test 'zt_get_field_from_raw gets empty expand' {
  # setup
  local raw_line='/tmp/dir'
  local expand_expected=''
  # exercise
  run zt_get_field_from_raw 'expand' <<< "$raw_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$expand_expected"
}

@test 'zt_get_field_from_pretty gets path on long format' {
  # setup
  local pretty_line='*/tmp/dir    -- Test directory.'
  local path_expected='/tmp/dir'
  # exercise
  run zt_get_field_from_pretty 'path' <<< "$pretty_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$path_expected"
}

@test 'zt_get_field_from_pretty gets description on long format' {
  # setup
  local pretty_line='*/tmp/dir    -- Test directory.'
  local description_expected='Test directory.'
  # exercise
  run zt_get_field_from_pretty 'description' <<< "$pretty_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$description_expected"
}

@test 'zt_get_field_from_pretty gets path on short format' {
  # setup
  local pretty_line='*/tmp/dir'
  local path_expected='/tmp/dir'
  # exercise
  run zt_get_field_from_pretty 'path' <<< "$pretty_line"
  # verify
  assert $state equals 0
  assert "$output" same_as "$path_expected"
}
